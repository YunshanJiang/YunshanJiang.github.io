<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title></title>
    <script src="lib/vuemin.js">
    </script>
    <link rel="stylesheet" type="text/css" href="rendererStyle.css">
  </head>
  <body>
    <div id="app" :class = "{'app':true}">
  <p>{{ message }}</p>
  <canvas id="canvas" :width="canvasWidth" :height="canvasHeight" :class = "{'canvas':true}"></canvas>
<input type="file" id="file-input" >
<div id="file-content"></div>
</div>

  </body>
     <script src="script/Device.js"> console.log(1);</script>
    <script src="script/SwapChain.js"></script>
    <script src="script/Math.js"></script>
    <script src="script/Camera.js"></script>
    <script src="script/Vertex.js"></script>
    <script src="script/Model.js"></script>
  <script>
  var vue = new Vue({
    el: '#app',
    data: {
      message: 'Hello Vue.js!',
      canvasWidth: Math.width,
      canvasHeight: Math.height
    }
  })
  </script>
   
    
  <script>
      
      var camera = new Camera(vue._data.canvasWidth/ vue._data.canvasHeight);
      var tstring = "v -1.430593 -1.430593 1.430593\nv 1.430593 -1.430593 1.430593\nf 7/13/21 1/1/22 11/17/23\nf 11/17/23 1/1/22 10/16/24";
      var ts = tstring.split(/\n|\rn|\nr|\r/);
       for(var i = 0; i < ts.length;i++){
                    if (ts[i][0] == "v")
                        {
                            var singleVertexSplit = ts[i].split(" ");
                            var tempVertex = new Vertex(singleVertexSplit[1], singleVertexSplit[2], singleVertexSplit[3], 0,0,0);
                            
                        }
                    else if (ts[i][0] == "f")
                        {
                            var singleVertexSplit = ts[i].split(" ");
                            for (var j = 1; j < singleVertexSplit.length; j++){
                                var indexSplit = singleVertexSplit[j].split('/');
                                console.log(indexSplit);
                            }
                            
                        }
                }
      console.log(ts);
      
      var model = new Model("src/tesetobj.obj");
      model.readModelFromSrc("src/tesetobj.obj");
      
      var verties = [new Vertex(-0.5,0.5,-0.5,1,0,0),
                     new Vertex(0.5,0.5,-0.5,1,0,0),
                     new Vertex(-0.5,-0.5,-0.5,1,0,0),
                     new Vertex(0.5,-0.5,-0.5,1,0,0),
                     new Vertex(-0.5,0.5,0.5,0,1,0),
                     new Vertex(0.5,0.5,0.5,0,0,1),
                     new Vertex(0.5,-0.5,0.5,1,0,0),
                    ];
     
      var indexBuffer = [0,1,2,
                   1,2,3,
                   0,4,5,
                   0,5,1,
                   3,1,5,
                   3,5,6,
                  ];
     
      var constantBuffer = {
          camera: camera,
          localOrigin: new Vector3(1.0, 0, 0),
      }
      var frame = 1000/30;
      var swapChain = new SwapChain();
      var device = swapChain.createDevice();
      var deviceContext = swapChain.createContext();
      var vertexSahder = device.createVertexShader();
      var pixelSahder = device.createPixelShader();
      
      vertexSahder.constantBuffer = constantBuffer;
      var frameBuffer = device.CreateBuffer(vue._data.canvasWidth * vue._data.canvasHeight * 4);
      swapChain.getBuffer(frameBuffer,vue._data.canvasWidth,vue._data.canvasHeight);
      var zBuffer = device.CreateBuffer(vue._data.canvasWidth * vue._data.canvasHeight, "zBuffer");
      
      var renderTargetView = device.createRenderTargetView(frameBuffer);
      var viewport = {
          startWidth:0,
          endWidth:vue._data.canvasWidth,
          startHeight:0,
          endHeight:vue._data.canvasHeight,
          canvasWidth: vue._data.canvasWidth,
          canvasHeight: vue._data.canvasHeight,
      }
      
      deviceContext.setViewport(viewport);
      deviceContext.setRenderTargetView(renderTargetView);
      deviceContext.setVertexShader(vertexSahder);
      deviceContext.setPixelShader(pixelSahder);
      deviceContext.setZBuffer(zBuffer);
      var outputVerties = [];
      var rotationRadian = 0;
      setInterval(function(){
         deviceContext.clear();  
          //deviceContext.drawLine(screenCoordate, screenCoordate2);
         // rotationRadian+= 0.01;
          constantBuffer.localOrigin = translationMatrix(new Vector3(0, 1, 0)).timeVector3OutV3(constantBuffer.localOrigin);
         // console.log(constantBuffer.localOrigin);
          for (var i = 0; i < model.verties.length; i++){
              var newPosition = rotateMatrixY(0.03).timeVector3OutV3(model.verties[i].position);
              model.verties[i].position = new Vector3(newPosition.x, newPosition.y, newPosition.z);
          }
          
          for (var i = 0; i < model.indexBuffer.length; i++)
              {
                  var index = model.indexBuffer[i];
                  
                  
                  var vertexOut = vertexSahder.vert(model.verties[index]);
                  
                  
                  outputVerties[i] = vertexOut;
                  
              }
           
          //deviceContext.drawTrianglesLineMode(outputVerties);
          deviceContext.drawTrianglesFace(outputVerties);
         //camera.cameraPosition = camera.cameraPosition.add(new Vector3(0.01,0.01,0));
          //console.log(vertexSahder.camera.cameraPosition);
        swapChain.present();
    
      },

    frame);


  </script>
</html>
